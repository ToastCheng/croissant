{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/tushicheng/dev/croissant/web/app/stream/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useRef, useEffect } from 'react';\n\nexport default function StreamPage() {\n    const [isConnected, setIsConnected] = useState(false);\n    const [isStreaming, setIsStreaming] = useState(false);\n    const [firstFrameReceived, setFirstFrameReceived] = useState(false);\n    const videoRef = useRef<HTMLImageElement>(null);\n    const wsRef = useRef<WebSocket | null>(null);\n\n    useEffect(() => {\n        // Connect to WebSocket server on mount\n        // Use environment variable if set, otherwise derive from current location\n        // This supports 'example.com' automatically assuming port 8080 is open\n        const protocol = window.location.protocol === 'https:' ? 'wss' : 'ws';\n        const host = window.location.hostname;\n        const port = '8080'; // Default port for stream-server\n\n        const wsUrl = process.env.WS_URL || `${protocol}://${host}:${port}`;\n\n        const ws = new WebSocket(wsUrl);\n        ws.binaryType = 'arraybuffer';\n\n        ws.onopen = () => {\n            console.log('Connected to Stream Server');\n            setIsConnected(true);\n        };\n\n        ws.onclose = () => {\n            console.log('Disconnected from Stream Server');\n            setIsConnected(false);\n            setIsStreaming(false);\n            setFirstFrameReceived(false);\n        };\n\n        ws.onmessage = (event) => {\n            // Crude handling: Assume each message is a full valid JPEG for this demo\n            // In production, we'd need a buffer builder to stitch chunks if they are fragmented\n            // For now, if 'image2pipe' flushes well, we might get away with it or see glitches\n            const arrayBuffer = event.data;\n            const blob = new Blob([arrayBuffer], { type: 'image/jpeg' });\n            const url = URL.createObjectURL(blob);\n\n            setFirstFrameReceived(true);\n\n            if (videoRef.current) {\n                // Revoke previous to avoid leak\n                const prev = videoRef.current.src;\n                if (prev.startsWith('blob:')) URL.revokeObjectURL(prev);\n                videoRef.current.src = url;\n            }\n        };\n\n        wsRef.current = ws;\n\n        return () => {\n            ws.close();\n        };\n    }, []);\n\n    const handleStart = () => {\n        if (wsRef.current && isConnected) {\n            setFirstFrameReceived(false);\n            wsRef.current.send('start');\n            setIsStreaming(true);\n        }\n    };\n\n    const handleStop = () => {\n        if (wsRef.current && isConnected) {\n            wsRef.current.send('stop');\n            setIsStreaming(false);\n            setFirstFrameReceived(false);\n        }\n    };\n\n    return (\n        <main className=\"min-h-screen bg-black text-white flex flex-col items-center justify-center p-8 pt-24\">\n            <h1 className=\"text-4xl font-bold mb-8 tracking-tighter\">Live Stream</h1>\n\n            <div className=\"relative w-full max-w-4xl aspect-video bg-zinc-900 rounded-2xl overflow-hidden border border-zinc-800 shadow-2xl flex items-center justify-center\">\n                {isConnected ? (\n                    <img\n                        ref={videoRef}\n                        alt=\"Live Stream\"\n                        className={`w-full h-full object-contain ${!firstFrameReceived && isStreaming ? 'opacity-0' : 'opacity-100'} transition-opacity duration-300`}\n                    />\n                ) : (\n                    <div className=\"text-zinc-500\">Connecting to server...</div>\n                )}\n\n                {/* Overlay if not streaming but connected */}\n                {isConnected && !isStreaming && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n                        <p className=\"text-xl font-medium\">Ready to Stream</p>\n                    </div>\n                )}\n\n                {/* Visual loading state when streaming started but no frame yet */}\n                {isConnected && isStreaming && !firstFrameReceived && (\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-zinc-900 z-10\">\n                        <div className=\"flex flex-col items-center gap-3\">\n                            <div className=\"w-8 h-8 border-4 border-white/20 border-t-white rounded-full animate-spin\" />\n                            <p className=\"text-sm text-zinc-400\">Initializing Stream...</p>\n                        </div>\n                    </div>\n                )}\n            </div>\n\n            <div className=\"mt-8 flex gap-6\">\n                <button\n                    onClick={handleStart}\n                    disabled={!isConnected || isStreaming}\n                    className=\"px-8 py-3 rounded-full bg-white text-black font-bold hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                >\n                    START STREAM\n                </button>\n                <button\n                    onClick={handleStop}\n                    disabled={!isConnected || !isStreaming}\n                    className=\"px-8 py-3 rounded-full bg-red-600 text-white font-bold hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all\"\n                >\n                    STOP STREAM\n                </button>\n            </div>\n\n            <div className=\"mt-4 text-xs text-zinc-500 font-mono\">\n                Status: {isConnected ? 'Connected' : 'Disconnected'} | Streaming: {isStreaming ? 'Active' : 'Idle'}\n            </div>\n        </main>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///Users/tushicheng/dev/croissant/web/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0]}}]
}